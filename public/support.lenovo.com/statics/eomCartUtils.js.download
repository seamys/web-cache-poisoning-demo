var eomCartUtils={userCart:{},orderFlow:{}};!function(){var r=function(r,t,e,o){var n=l.UrlUtility.getFullServicesPathV4("/eomCart"+t);if("GET"==r&&e){for(var a in n+=n.indexOf("?")>0?"&":"?",e)n+=a+"="+encodeURIComponent(e[a])+"&";n=n.substring(0,n.length-1)}var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==this.readyState){var r=null;if(200==this.status&&this.responseText)try{r=JSON.parse(this.responseText)}catch(r){console.error(r)}o(r||{code:100,msg:{desc:"Failed",value:null},data:null})}},i.open(r,n,!0),"POST"==r&&i.setRequestHeader("content-type","application/json;charset=UTF-8"),"POST"==r&&e?i.send(JSON.stringify(e)):i.send()},t=function(t,e,o){return new Promise((function(n,a){r(t,e,o,(function(r){0==r.code?n(r.data):a(r)}))}))};eomCartUtils.isSupportSale=function(r,t){if("true"==eomCartUtils.userCart.fot||"true"==l.UrlUtility.getUrlParam("redportfot"))return!0;var e=window.config?window.config.shopConfigs:null;if(void 0===e)return!t;if(null==e)return!1;if(!e.channels||0==e.channels.length)return!0;for(var o in e.channels){var n=e.channels[o];if(n.channel.toLowerCase()==r.toLowerCase()){if(!t)return!0;if(!n.productTypes||0==n.productTypes.length)return!0;for(var a in n.productTypes)if(n.productTypes[a].toLowerCase()==t.toLowerCase())return!0}}return!1},eomCartUtils.userCart.isSupportSale=function(r){return eomCartUtils.isSupportSale(eomCartUtils.userCart.channel,r)},eomCartUtils.userCart.setProperty=function(r,t,e){r&&(t||(t=sessionStorage.getItem("eomUserCartProperties_"+r)),!t&&e&&(t=e),eomCartUtils.userCart[r]=t,t&&sessionStorage.setItem("eomUserCartProperties_"+r,t))},eomCartUtils.userCart.get=function(r){return t("POST","/user/get",{channel:r||eomCartUtils.userCart.channel})};var e=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i;eomCartUtils.userCart.add=function(r){r=Object.assign({channel:eomCartUtils.userCart.channel,cid:eomCartUtils.userCart.cid,source:eomCartUtils.userCart.source,subSource:eomCartUtils.userCart.subSource,posaId:eomCartUtils.userCart.posaId,client:e.test(navigator.userAgent)?"Mobile":""},r);var o="/user/add";return eomCartUtils.userCart.fot&&(o+="?fot="+eomCartUtils.userCart.fot),t("POST",o,r)},eomCartUtils.userCart.addMulti=function(r){r=Object.assign({channel:eomCartUtils.userCart.channel,cid:eomCartUtils.userCart.cid,subSource:eomCartUtils.userCart.subSource},r);var e="/user/addMulti";return eomCartUtils.userCart.fot&&(e+="?fot="+eomCartUtils.userCart.fot),t("POST",e,r)},eomCartUtils.userCart.update=function(r){return r=Object.assign({channel:eomCartUtils.userCart.channel},r),t("POST","/user/update",r)},eomCartUtils.userCart.delete=function(r){return r=Object.assign({channel:eomCartUtils.userCart.channel},r),t("POST","/user/delete",r)},eomCartUtils.userCart.clear=function(r){return t("POST","/user/clear",{channel:r||eomCartUtils.userCart.channel})},eomCartUtils.userCart.applyCoupon=function(r,e){var o="/user/applyCoupon";eomCartUtils.userCart.fot&&(o+="?fot="+eomCartUtils.userCart.fot);var n={couponNumber:r,channel:e||eomCartUtils.userCart.channel};return eomCartUtils.userCart.posaId&&(n.posaId=eomCartUtils.userCart.posaId),t("POST",o,n)};var o=function(r,t,e){input=document.createElement("input"),input.type="hidden",input.name=r,input.value=t,e.append(input)},n=function(r,t){var e=document.createElement("Form");return e.method="POST",e.action=r.url,o("userId",r.userId,e),o("token",r.token,e),o("anonymous",r.anonymous,e),o("errorUrl",l.UrlUtility.getFullPath("/handlemessage",!0),e),o("partsalesTargetUrl",t,e),e};eomCartUtils.userCart.checkout=function(r){return new Promise((function(e,o){t("POST","/user/checkout",{channel:r||eomCartUtils.userCart.channel}).then((function(r){var t=Cookies.get("clickViewPage")||location.href.toString(),o=n(r,t);document.body.append(o),o.submit(),e()})).catch((function(r){o(r)}))}))},eomCartUtils.orderFlow.auth=function(r,e){return t("POST","/orderFlow/auth",{channel:r,msdSSOToken:e})},eomCartUtils.orderFlow.queryHistories=function(r){return t("POST","/orderFlow/queryHistories",r)},eomCartUtils.orderFlow.sendHistoryEmailAndSMS=function(r){return t("POST","/orderFlow/sendHistoryEmailAndSMS",r)},eomCartUtils.orderFlow.add=function(r){var e="/orderFlow/add",o=l.UrlUtility.getUrlParam("redportfot");return o&&(e+="?fot="+o),t("POST",e,r)},eomCartUtils.orderFlow.addMulti=function(r){var e="/orderFlow/addMulti",o=l.UrlUtility.getUrlParam("redportfot");return o&&(e+="?fot="+o),t("POST",e,r)},eomCartUtils.orderFlow.applyCoupon=function(r){var e="/orderFlow/applyCoupon",o=l.UrlUtility.getUrlParam("redportfot");return o&&(e+="?fot="+o),t("POST",e,r)},eomCartUtils.orderFlow.submit=function(r){return t("POST","/orderFlow/submit",r)},eomCartUtils.orderFlow.get=function(r,e){return t("POST","/orderFlow/get",{orderNumber:r,token:e})},eomCartUtils.orderFlow.reject=function(r,e,o){return t("POST","/orderFlow/reject",{orderNumber:r,token:e,rejectReason:o})},eomCartUtils.orderFlow.accept=function(r,e){return new Promise((function(o,a){t("POST","/orderFlow/accept",{orderNumber:r,token:e}).then((function(r){var t=Cookies.get("clickViewPage")||location.href.toString(),e=n(r,t);document.body.append(e),e.submit(),o()})).catch((function(r){a(r)}))}))},eomCartUtils.orderFlow.register=function(r){return t("POST","/orderFlow/register",r)};eomCartUtils.initShopConfigs=function(t){t=t||l.CultureUtility.getCurrentCountry();var e=window.config?window.config.shopConfigs:null;return e&&e.country&&e.country.toLowerCase()==t.toLowerCase()?new Promise((function(r){r()})):new Promise((function(o){r("GET","/getShopConfigs",{country:t},(function(r){e=r&&0==r.code?r.data:void 0,window.config?window.config.shopConfigs=e:window.config={shopConfigs:e},o()}))}))};eomCartUtils.userCart.setProperty("channel",null,"APOS"),eomCartUtils.userCart.setProperty("source",l.UrlUtility.getUrlParam("source")||l.UrlUtility.getUrlParam("utm_source")),eomCartUtils.userCart.setProperty("posaId",l.UrlUtility.getUrlParam("posaId")),eomCartUtils.userCart.setProperty("subSource",l.UrlUtility.getUrlParam("subSource")),eomCartUtils.userCart.setProperty("cid",l.UrlUtility.getUrlParam("cid")),eomCartUtils.userCart.setProperty("urlCoupon",l.UrlUtility.getUrlParam("coupon")),eomCartUtils.userCart.setProperty("fot",l.UrlUtility.getUrlParam("redportfot")),(eomCartUtils.userCart.source&&"posa"==eomCartUtils.userCart.source.toLowerCase()||eomCartUtils.userCart.posaId)&&eomCartUtils.userCart.setProperty("channel","POSA_TAKE_HOME")}(),window.eomCartUtils=eomCartUtils;